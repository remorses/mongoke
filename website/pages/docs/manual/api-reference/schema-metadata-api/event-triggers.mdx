
Schema/Metadata API Reference: Event Triggers
=============================================

Table of contents

Event triggers are used to capture database changes and send them to a
configured webhook.

create\_event\_trigger
----------------------

`create_event_trigger` is used to create a new event trigger or replace
an existing event trigger.

```http
POST /v1/query HTTP/1.1
Content-Type: application/json
X-Hasura-Role: admin

{
    "type" : "create_event_trigger",
    "args" : {
        "name": "sample_trigger",
        "table": {
           "name": "users",
           "schema": "public",
        },
        "webhook": "https://httpbin.org/post",
        "insert": {
            "columns": "*",
            "payload": ["username"]
        },
        "update": {
            "columns": ["username", "real_name"],
            "payload": "*"
        },
        "delete": {
            "columns": "*"
        },
        "headers":[
          {
              "name": "X-Hasura-From-Val",
              "value": "myvalue"
          },
          {
              "name": "X-Hasura-From-Env",
              "value_from_env": "EVENT_WEBHOOK_HEADER"
          }
        ],
        "replace": false
    }
}
```

### Args syntax

  Key                  Required   Schema                                                                                                                                     Description
  -------------------- ---------- ------------------------------------------------------------------------------------------------------------------------------------------ -----------------------------------------------------------------------
  name                 true       [TriggerName](#triggername)                                                                                                                Name of the event trigger
  table                true       `QualifiedTable <QualifiedTable>`{.interpreted-text role="ref"}                                                                            Object with table name and schema
  webhook              false      String                                                                                                                                     Full url of webhook (\*)
  webhook\_from\_env   false      String                                                                                                                                     Environment variable name of webhook (must exist at boot time) (\*)
  insert               false      [OperationSpec](#operationspec)                                                                                                            Specification for insert operation
  update               false      [OperationSpec](#operationspec)                                                                                                            Specification for update operation
  delete               false      [OperationSpec](#operationspec)                                                                                                            Specification for delete operation
  headers              false      \[ `HeaderFromValue <HeaderFromValue>`{.interpreted-text role="ref"} \| `HeaderFromEnv <HeaderFromEnv>`{.interpreted-text role="ref"} \]   List of headers to be sent with the webhook
  retry\_conf          false      [RetryConf](#retryconf)                                                                                                                    Retry configuration if event delivery fails
  replace              false      Boolean                                                                                                                                    If set to true, the event trigger is replaced with the new definition

(\*) Either `webhook` or `webhook_from_env` are required.

delete\_event\_trigger
----------------------

`delete_event_trigger` is used to delete an event trigger.

```http
POST /v1/query HTTP/1.1
Content-Type: application/json
X-Hasura-Role: admin

{
    "type" : "delete_event_trigger",
    "args" : {
        "name": "sample_trigger"
    }
}
```

### Args syntax

  Key    Required   Schema                        Description
  ------ ---------- ----------------------------- ---------------------------
  name   true       [TriggerName](#triggername)   Name of the event trigger

redeliver\_event
----------------

`redeliver_event` is used to redeliver an existing event. For example,
if an event is marked as error ( say it did not succeed after retries),
you can redeliver it using this API. Note that this will reset the count
of retries so far. If the event fails to deliver, it will be retried
automatically according to its `retry_conf`.

```http
POST /v1/query HTTP/1.1
Content-Type: application/json
X-Hasura-Role: admin

{
    "type" : "redeliver_event",
    "args" : {
        "event_id": "ad4f698f-a14e-4a6d-a01b-38cd252dd8bf"
    }
}
```

### Args syntax

  Key         Required   Schema   Description
  ----------- ---------- -------- -------------------
  event\_id   true       String   UUID of the event

invoke\_event\_trigger
----------------------

`invoke_event_trigger` is used to invoke an event trigger with custom
payload.

```http
POST /v1/query HTTP/1.1
Content-Type: application/json
X-Hasura-Role: admin

{
    "type" : "invoke_event_trigger",
    "args" : {
        "name": "sample_trigger",
        "payload": {}
    }
}
```

### Args syntax

  Key       Required   Schema                        Description
  --------- ---------- ----------------------------- --------------------------------------
  name      true       [TriggerName](#triggername)   Name of the event trigger
  payload   true       JSON                          Some JSON payload to send to trigger

#### TriggerName

String

#### OperationSpec

  Key       Required   Schema                                        Description
  --------- ---------- --------------------------------------------- --------------------------------------------------------------
  columns   true       [EventTriggerColumns](#eventtriggercolumns)   List of columns or \"\*\" to listen to changes
  payload   false      [EventTriggerColumns](#eventtriggercolumns)   List of columns or \"\*\" to send as part of webhook payload

#### EventTriggerColumns

\"\*\" \| \[`PGColumn`{.interpreted-text role="ref"}\]

#### RetryConf

  Key             required   Schema    Description
  --------------- ---------- --------- -----------------------------------------------------------------------
  num\_retries    false      Integer   Number of times to retry delivery. Default: 0
  interval\_sec   false      Integer   Number of seconds to wait between each retry. Default: 10
  timeout\_sec    false      Integer   Number of seconds to wait for response before timing out. Default: 60
